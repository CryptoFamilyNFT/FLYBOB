{"version":3,"sources":["containers/Menu/Scene/Scene.module.css","assets/images/go.png","assets/images/bg.png","assets/images/fg.png","assets/images/pipeNorth.png","assets/images/pipeSouth.png","assets/sounds/fly.mp3","assets/sounds/score.mp3","helpers/createImage.ts","helpers/createAudio.ts","containers/Menu/Scene/constants.ts","assets/images/bird.png","containers/Menu/Scene/Scene.tsx"],"names":["createImage","url","Promise","resolve","reject","image","Image","addEventListener","error","setAttribute","src","createAudio","Audio","CANVAS","BIRD","position","x","y","sceneImages","Map","Background","Ground","TopPipe","BottomPipe","sounds","FlySound","ScoreSound","SCORE_TEXT","score","BIRD_COPY","_cloneDeep","backgroundImage","birdImage","groundImage","topPipeImage","bottomPipeImage","flySound","scoreSound","Scene","gameOverModal","setGameOverModal","useState","finalScore","setFinalScore","canvasRef","useRef","canvasContext","pipesCoordinate","context","saveContext","useContext","EtherContext","connectWallet","setConnectWallet","notBob","setCloseNotBOB","canvasInteractionEnabled","setCanvasInteractionEnabled","isPlayable","setIsPlayable","topScore","setTopScore","requestID","isConnected","connected","useEffect","BobTokenIds","length","CheckScorePlayer","async","scoreToVerify","player","_await$Api$getScoreBy","prev_score","Api","getScoreByUser","isExist","_context$addressSigne","findPlayer","addressSigner","then","scores","console","log","catch","e","getPlayer","playerScore","find","n","Number","update","updatePlayer","toString","addScore","setStarterValues","useCallback","_canvasRef$current","current","width","handleCanvasInteraction","rotation","play","renderer","_BIRD_COPY$rotation","nuovaLarghezza","nuovaAltezza","height","drawImage","i","constant","Math","floor","random","save","translate","rotate","PI","restore","scoreText","scoreTextWidth","measureText","scoreX","scoreY","fillStyle","font","fillText","window","requestAnimationFrame","removeEventListeners","_canvasRef$current2","removeEventListener","keyDownPressHandler","cancelAnimationFrame","getContext","get","loadSceneImages","_canvasRef$current3","handleRestartGame","_context$addressSigne2","setTimeout","React","createElement","style","marginTop","color","Modal","open","className","classes","onClose","closeModalConnected","marginLeft","display","justifyContent","gap","marginRight","Connector","ModeSwitcher","mr","zIndex","flexDirection","alignItems","href","target","rel","Button","onClick","variant","background","NavLink","to","go","alt","Fragment","ref"],"mappings":"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","file":"static/js/SceneComponent.c1613177.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nexport default {\"Scene\":\"Scene_Scene__2ORqK\",\"Modal\":\"Scene_Modal__1GXGW\",\"modal\":\"Scene_modal__3yRm3\",\"paper\":\"Scene_paper__2XaWO\",\"gameOverImage\":\"Scene_gameOverImage__3EAhY\",\"gameOverButton\":\"Scene_gameOverButton__R1mLj\",\"GameOver\":\"Scene_GameOver__1ogRP\"};","export default __webpack_public_path__ + \"static/media/go.69f9c238.png\";","export default __webpack_public_path__ + \"static/media/bg.8792c010.png\";","export default __webpack_public_path__ + \"static/media/fg.0f9cbff0.png\";","export default __webpack_public_path__ + \"static/media/pipeNorth.96834043.png\";","export default __webpack_public_path__ + \"static/media/pipeSouth.ce0b7a5c.png\";","export default __webpack_public_path__ + \"static/media/fly.e734c795.mp3\";","export default __webpack_public_path__ + \"static/media/score.92d4be02.mp3\";","export function createImage(url: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const image = new Image();\n    image.addEventListener('load', () => resolve(image));\n    image.addEventListener('error', error => reject(error));\n    image.setAttribute('crossOrigin', 'anonymous');\n    image.src = url;\n  });\n}\n","export function createAudio(url: string): HTMLAudioElement {\n  return new Audio(url);\n}\n","import {CoordinatesType} from './Scene.types';\nimport Background from \"../../../assets/images/bg.png\";\nimport Bird from \"../../../assets/images/bird.png\";\nimport Ground from \"../../../assets/images/fg.png\";\nimport TopPipe from \"../../../assets/images/pipeNorth.png\";\nimport BottomPipe from \"../../../assets/images/pipeSouth.png\";\nimport FlySound from \"../../../assets/sounds/fly.mp3\";\nimport ScoreSound from \"../../../assets/sounds/score.mp3\";\nimport {createAudio, createImage} from \"../../../helpers\";\n\nexport const GAP_VALUE = 90;\nexport const GRAVITATION_VALUE = 1.7;\n\nexport const CANVAS = {\n  width: 288,\n  height: 512\n}\n\nexport const BIRD: { position: CoordinatesType } = {\n  position:  {\n    x: 10,\n    y: 150\n  }\n};\n\nexport const PIPE_X_ENDPOINT = 125;\nexport const PIPE_X_UPPER_SCORE = 5;\n\nexport const sceneImages = new Map([\n  [\n    'background',\n    createImage(Background)\n  ],\n  [\n    'bird',\n    createImage(Bird)\n  ],\n  [\n    'ground',\n    createImage(Ground)\n  ],\n  [\n    'topPipe',\n    createImage(TopPipe)\n  ],\n  [\n    'bottomPipe',\n    createImage(BottomPipe)\n  ]\n]);\n\nexport const sounds = new Map([\n  [\n    'fly',\n    createAudio(FlySound)\n  ],\n  [\n    'score', createAudio(ScoreSound)\n  ]\n]);\n\nexport const SCORE_TEXT = {\n  fill: '#00FFFF',\n  font: '32px Josefin Sans, sans-serif',\n  text: (score: number) => `${score}`\n}\n","export default \"data:image/png;base64,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\"","import React, { useEffect, useRef, useCallback, useState, useContext } from 'react';\nimport classes from './Scene.module.css';\nimport _cloneDeep from 'lodash/cloneDeep';\nimport go from \"../../../assets/images/go.png\";\nimport { Button, Modal } from '@mui/material';\nimport { Alert, AlertTitle } from '@mui/material';\n\nimport {\n  sounds,\n  sceneImages,\n  GAP_VALUE,\n  GRAVITATION_VALUE,\n  BIRD,\n  PIPE_X_ENDPOINT,\n  CANVAS,\n  PIPE_X_UPPER_SCORE,\n  SCORE_TEXT\n} from './constants';\nimport { CoordinatesType } from './Scene.types';\nimport Api from '../../../api/api';\nimport { EtherContext, EtherContextRepository } from '../../../ethers/EtherContext';\nimport { IEtherContext } from '../../../ethers/IEtherContext';\nimport Connector from '../../../Connector';\nimport { ModeSwitcher } from '../../../ModeSwitcher';\nimport { Link, NavLink } from 'react-router-dom';\n\nconst BIRD_COPY: {\n  rotation?: number; position: CoordinatesType\n} = _cloneDeep(BIRD);\n\nlet backgroundImage: HTMLImageElement;\nlet birdImage: HTMLImageElement;\nlet groundImage: HTMLImageElement;\nlet topPipeImage: HTMLImageElement;\nlet bottomPipeImage: HTMLImageElement;\nlet flySound: HTMLAudioElement;\nlet scoreSound: HTMLAudioElement\n\ninterface Score {\n  player: string;\n  score: string;\n}\n\n\n\n/*\nconst addScores = () => {\n  Api.addScore('Player1', '100')\n    .then(() => {\n      console.log('Score added');\n    })\n    .catch((error: any) => {\n      console.error('Error adding score:', error);\n    });\n}\n*/\n\nconst Scene = () => {\n\n  const [gameOverModal, setGameOverModal] = useState(false);\n  const [finalScore, setFinalScore] = useState(0);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const canvasContext = useRef<CanvasRenderingContext2D>();\n  const pipesCoordinate = useRef<CoordinatesType[]>([]);\n  const { context, saveContext } = useContext(EtherContext) as EtherContextRepository;\n  const [connectWallet, setConnectWallet] = useState(true)\n  const [notBob, setCloseNotBOB] = useState(false)\n  const [canvasInteractionEnabled, setCanvasInteractionEnabled] = useState(false);\n  const [isPlayable, setIsPlayable] = useState(false);\n  const [topScore, setTopScore] = useState(0)\n  const score = useRef<number>(0);\n  const requestID = useRef<number>(0);\n  const isConnected = context.connected || false;\n\n  useEffect(() => {\n    if (context.connected && context?.BobTokenIds && context?.BobTokenIds.length === 0) {\n      setCanvasInteractionEnabled(false);\n    } else {\n      setCanvasInteractionEnabled(true);\n    }\n  }, [context?.BobTokenIds, context.connected]);\n\n  const GetScore = () => {\n    Api.getScores()\n      .then((scores: any) => {\n        console.log('Scores:', scores);\n      })\n      .catch((error: any) => {\n        console.error('Error fetching scores:', error);\n      });\n  }\n\n  const getPlayer = async () => {\n    try {\n      const player = Api.findPlayer(context.addressSigner ?? '')\n        .then((scores) => {\n          if (scores.length > 0) {\n            console.log(`Scores:`, scores);\n            return true\n          } else {\n            console.log('Player1 not found');\n            return false\n          }\n        })\n      return player\n        .catch((error: any) => {\n          console.error('Error fetching scores for Player1:', error);\n        });\n    } catch (e: any) {\n      console.log(\"Error on getPlayer: \", e)\n    }\n  }\n\n  const CheckScorePlayer = async (scoreToVerify: number, player: string) => {\n    let prev_score = await Api.getScoreByUser(player) ?? 0;\n    let isExist = await getPlayer()\n    const playerScore = prev_score.find(n => n.player === context.addressSigner);\n    console.log(playerScore.score)\n    if (scoreToVerify >= Number(playerScore.score)) {\n      const update = await Api.updatePlayer(player, scoreToVerify.toString())\n      console.log('updated score: ', update)\n    }\n    if (scoreToVerify === 0 && isExist === false) {\n      const add = await Api.addScore(player, scoreToVerify.toString())\n      console.log('updated score: ', scoreToVerify)\n    } else {\n      console.log('not updated score')\n    }\n\n  }\n\n\n  const loadSceneImages = async () => {\n    backgroundImage = await sceneImages.get('background') as HTMLImageElement;\n    birdImage = await sceneImages.get('bird') as HTMLImageElement;\n    groundImage = await sceneImages.get('ground') as HTMLImageElement;\n    topPipeImage = await sceneImages.get('topPipe') as HTMLImageElement;\n    bottomPipeImage = await sceneImages.get('bottomPipe') as HTMLImageElement;\n  };\n\n  const loadSceneSounds = () => {\n    flySound = sounds.get('fly') as HTMLAudioElement;\n    scoreSound = sounds.get('score') as HTMLAudioElement;\n  }\n\n  const initCanvasContext = () => {\n    if (canvasRef.current) {\n      canvasContext.current = canvasRef.current.getContext('2d') as CanvasRenderingContext2D;\n    }\n  };\n\n  const setStarterValues = useCallback(() => {\n    BIRD_COPY.position = {\n      ...BIRD.position\n    };\n\n    score.current = 0;\n\n    pipesCoordinate.current = [\n      {\n        x: canvasRef.current?.width as number,\n        y: 0,\n      }\n    ];\n  }, []);\n\n  const handleCanvasInteraction = () => {\n    // Only allow canvas interaction if isConnected is true\n    if (isConnected) {\n      BIRD_COPY.position.y -= 30;\n      BIRD_COPY.rotation = -60;\n      flySound.play();\n    }\n  };\n\n  const renderer = useCallback(() => {\n    if (!canvasContext.current || !canvasRef.current || !isConnected) return;\n    const nuovaLarghezza = backgroundImage.width + 50; // Mantieni la stessa larghezza\n    const nuovaAltezza = backgroundImage.height * 2.5; // Aumenta l'altezza al doppio\n    canvasContext.current.drawImage(\n      backgroundImage,\n      0,\n      0,\n      nuovaLarghezza,\n      nuovaAltezza\n    );\n    for (let i = 0; i < pipesCoordinate.current.length; i++) {\n      const constant = topPipeImage.height + GAP_VALUE;\n\n      /* Draw top pipe */\n      canvasContext.current.drawImage(\n        topPipeImage,\n        pipesCoordinate.current[i].x,\n        pipesCoordinate.current[i].y\n      );\n\n      /* Draw bottom pipe */\n      canvasContext.current.drawImage(\n        bottomPipeImage,\n        pipesCoordinate.current[i].x,\n        pipesCoordinate.current[i].y + constant\n      );\n\n      /* Move pipes */\n      pipesCoordinate.current[i].x--;\n\n      /* Add new pipes */\n      if (pipesCoordinate.current[i].x === PIPE_X_ENDPOINT) {\n        pipesCoordinate.current = [\n          ...pipesCoordinate.current,\n          {\n            x: canvasRef.current.width,\n            y: Math.floor(Math.random() * topPipeImage.height) - topPipeImage.height,\n          }\n        ];\n      }\n\n      /* Bit about pipes */\n      if (\n        (\n          BIRD_COPY.position.x + birdImage.width >= pipesCoordinate.current[i].x &&\n          BIRD_COPY.position.x <= pipesCoordinate.current[i].x + topPipeImage.width &&\n          (\n            BIRD_COPY.position.y <= pipesCoordinate.current[i].y + topPipeImage.height ||\n            BIRD_COPY.position.y + birdImage.height >= pipesCoordinate.current[i].y + constant\n          )\n        ) ||\n        BIRD_COPY.position.y + birdImage.height >= canvasRef.current.height - groundImage.height\n      ) {\n\n        console.log('Game over');\n        setGameOverModal(true);\n        setFinalScore(score.current);\n        return; // Termina la funzione qui\n      }\n\n      /* Change score */\n      if (pipesCoordinate.current[i].x === PIPE_X_UPPER_SCORE) {\n        score.current++;\n        scoreSound.play();\n      }\n    }\n\n    /* Draw ground */\n    canvasContext.current.drawImage(\n      groundImage,\n      0,\n      canvasRef.current.height - groundImage.height,\n      groundImage.width + 50,\n      groundImage.height,\n    );\n\n    /* Draw bird */\n    canvasContext.current.save(); // Save the current canvas state\n    canvasContext.current.translate(\n      BIRD_COPY.position.x + birdImage.width / 2,\n      BIRD_COPY.position.y + birdImage.height / 2\n    );\n    canvasContext.current.rotate((BIRD_COPY.rotation ?? 45 * Math.PI) / 180); // Convert degrees to radians\n    canvasContext.current.drawImage(\n      birdImage,\n      -birdImage.width / 2,\n      -birdImage.height / 2,\n      birdImage.width,\n      birdImage.height\n    );\n    canvasContext.current.restore();\n\n    BIRD_COPY.rotation = -45; // Reset rotation to 0\n    let BIRD_DEG = 45;\n\n    BIRD_COPY.position.y += GRAVITATION_VALUE;\n    BIRD_COPY.rotation += BIRD_DEG;\n\n    /* Draw score */\n    /* Draw score */\n    const scoreText = SCORE_TEXT.text(score.current);\n    const scoreTextWidth = canvasContext.current.measureText(scoreText).width;\n    const scoreX = (canvasRef.current.width - scoreTextWidth) / 2;\n    const scoreY = canvasRef.current.height - 450; // Center with marginTop of 50\n\n    canvasContext.current.fillStyle = SCORE_TEXT.fill;\n    canvasContext.current.font = SCORE_TEXT.font;\n    canvasContext.current.fillText(scoreText, scoreX, scoreY);\n\n    requestID.current = window.requestAnimationFrame(renderer);\n  }, [setStarterValues, isConnected]);\n\n  const removeEventListeners = useCallback(() => {\n    window.removeEventListener('keydown', keyDownPressHandler);\n    canvasRef.current?.removeEventListener('touchstart', keyDownPressHandler);\n    window.cancelAnimationFrame(requestID.current);\n  }, [requestID]);\n\n\n\n  const keyDownPressHandler = () => {\n\n    BIRD_COPY.position.y -= 20;\n    BIRD_COPY.rotation = -60 // Set rotation angle to 45 degrees\n    flySound.play();\n  };\n\n  const keyUpPressHandler = () => {\n    BIRD_COPY.rotation = -45; // Set rotation angle to -45 degrees when key is released\n  };\n\n  useEffect(() => {\n    initCanvasContext();\n    setStarterValues();\n    loadSceneSounds();\n    (async () => {\n      await loadSceneImages();\n      renderer();\n      window.addEventListener('keydown', keyDownPressHandler);\n      canvasRef.current?.addEventListener('touchstart', handleCanvasInteraction);\n    })();\n\n    return () => {\n      removeEventListeners();\n    };\n  }, [removeEventListeners, renderer, setStarterValues, canvasInteractionEnabled]);\n\n  const CheckWalletConnect = () => {\n    if (context.connected !== true) {\n      setConnectWallet(false)\n    }\n  }\n\n  const closeModalBob = () => {\n    setCloseNotBOB(false)\n  }\n\n  useEffect(() => {\n    if (context.connected && context?.BobTokenIds && context?.BobTokenIds.length === 0) {\n      setCloseNotBOB(true)\n    }\n\n  }, [context?.BobTokenIds, context.connected])\n\n  useEffect(() => {\n    if (isConnected) {\n      setIsPlayable(true)\n    }\n\n  }, [canvasInteractionEnabled])\n\n\n  const enableGame = () => {\n    if (isConnected && context?.BobTokenIds && context?.BobTokenIds.length > 0) {\n      setConnectWallet(true);\n      setCanvasInteractionEnabled(true);\n      setIsPlayable(true);\n      setStarterValues();\n      renderer();\n    } else {\n      setConnectWallet(isConnected);\n      setIsPlayable(false);\n      setCanvasInteractionEnabled(false);\n    }\n  };\n\n  const handleRestartGame = () => {\n    CheckScorePlayer(finalScore, context.addressSigner ?? '')\n      .then(() => {\n        // Setta un flag per indicare che il gioco è in pausa\n        setIsPlayable(false);\n\n        // Avvia il gioco dopo mezzo secondo\n        setTimeout(() => {\n          setIsPlayable(true);\n          setGameOverModal(false);\n          setFinalScore(score.current);\n          setStarterValues();\n          renderer();\n        }, 500);\n      })\n      .catch(error => {\n        console.error('Error checking score:', error);\n        // Nel caso di un errore, gestisci come preferisci\n      });\n  };\n\n  const closeModalConnected = () => {\n    let connected: boolean = isConnected\n    return connected\n  }\n\n  console.log(\"isConnected Modal: \", connectWallet)\n  console.log(\"isPlayable: \", isPlayable)\n\n  return (\n    <div style={{ height: '100%', marginTop: 100 }} >\n      <div>\n        <p style={{ color: 'yellow', font: '32px Josefin Sans, sans-serif' }}>My TOP Score: {context.score}</p>\n      </div>\n\n      <Modal\n        open={!isConnected}\n        className={classes.modal}\n        onClose={closeModalConnected}\n      >\n        <div className={classes.paper}>\n          <p style={{ color: 'yellow', font: '32px Josefin Sans, sans-serif' }}>Please Connect Your Wallet!</p>\n          <div style={{ marginLeft: 'auto', display: 'flex', justifyContent: 'center', gap: 10, marginRight: 0 }}>\n            <Connector>\n              <ModeSwitcher mr={4} />\n            </Connector>\n          </div>\n        </div>\n      </Modal>\n\n      <Modal\n        open={notBob}\n        className={classes.modal}\n        style={{ zIndex: 9999 }}\n      >\n        <div className={classes.paper}>\n          <p style={{ color: 'yellow', font: '32px Josefin Sans, sans-serif' }}>You don't have any BobHeadz :(</p>\n          <div style={{ display: 'flex', flexDirection: 'row', gap: 20, justifyContent: 'center', alignItems: 'center' }}>\n            <a href='https://app.ebisusbay.com/collection/bob-headz' target=\"_blank\" rel=\"noopener noreferrer\">\n              <Button\n                onClick={handleRestartGame}\n                variant=\"contained\"\n                color=\"primary\"\n              >\n                Buy One\n              </Button>\n            </a>\n            <Button style={{ color: 'black', background: 'yellow', width: 50 }} variant='contained'>\n              <NavLink to='/'>Home</NavLink>\n            </Button>\n          </div>\n        </div>\n      </Modal>\n\n      <Modal\n        open={gameOverModal}\n        onClose={() => handleRestartGame()}\n        className={classes.modal}\n      /*onKeyDown={(event) => {\n        if (event.key === 'Enter' || event.key === ' ') {\n          handleRestartGame();\n        }\n      }}*/\n      >\n        <div className={classes.paper}>\n          <img src={go} alt=\"GameOver\" className={classes.gameOverImage} />\n          <p style={{ color: 'yellow', font: '32px Josefin Sans, sans-serif' }}>{finalScore}</p>\n          {!isConnected && (\n            <>\n              <p style={{ color: 'yellow', font: '32px Josefin Sans, sans-serif' }}>Please Connect Your Wallet!</p>\n              <div style={{ marginLeft: 'auto', display: 'flex', justifyContent: 'center', gap: 10, marginRight: 0 }}>\n                <Connector>\n                  <ModeSwitcher mr={4} />\n                </Connector>\n              </div>\n            </>\n          )}\n          {isConnected && (\n            <Button\n              className={classes.gameOverButton}\n              onClick={handleRestartGame}\n              variant=\"contained\"\n              color=\"primary\"\n            >\n              Restart Game\n            </Button>\n          )}\n        </div>\n      </Modal>\n\n\n      <canvas\n        className={classes.Scene}\n        ref={canvasRef}\n        width={CANVAS.width}\n        height={CANVAS.height} />\n\n    </div >\n  );\n};\n\nexport default Scene;\n"],"sourceRoot":""}